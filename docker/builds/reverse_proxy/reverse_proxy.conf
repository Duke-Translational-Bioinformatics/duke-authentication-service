<VirtualHost _default_:443>
  # print errors to stdout
  ErrorLog "|cat"
  LogLevel warn

  SSLEngine on
  SSLProxyEngine on
  SSLCertificateFile /etc/pki/tls/certs/localhost.crt
  SSLCertificateKeyFile /etc/pki/tls/private/localhost.key
  SSLProtocol all -SSLv2
  SSLCipherSuite ALL:!ADH:!EXPORT:!SSLv2:RC4+RSA:+HIGH:+MEDIUM:+LOW
  SetEnvIf User-Agent ".*MSIE.*" \
      nokeepalive ssl-unclean-shutdown \
      downgrade-1.0 force-response-1.0


  LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-agent}i\"" combined
  CustomLog "|cat" combined

#  ProxyPass / balancer:bal//adgapps-prod/coi_form nofailover=On
#  ProxyPassReverse / balancer://adgapps-prod/

  ProxyPass / http://protected.app:3000/
  ProxyPassReverse / http://protected.app:3000/

  <Location /auth/shibboleth/callback>
    RewriteEngine On
    RewriteCond %{LA-U:QUERY_STRING} foo=([^&]+)
    RewriteRule .* - [E=UID:%1,NS]

    RewriteCond %{LA-U:QUERY_STRING} bar=([^&]+)
    RewriteRule .* - [E=FIRSTNAME:%1,NS]

    RequestHeader set UID %{UID}e
    RequestHeader set FIRSTNAME %{FIRSTNAME}e
  </Location>

</VirtualHost>
