# To make this file default docker-compose file run the following (or add ~/.bash_profile):
# export COMPOSE_FILE=dc-dev.utils.yml
server:
  build: .
  environment:
    - RAILS_ENV=development
    - REDIS_HOST=redis.local
    - REDIS_PORT=6379
  volumes:
    - .:/var/www/app
  links:
    - 'redis:redis.local'
redis:
  image: redis
shibconfig:
  image: shibconfig
rproxy:
  build: ./docker/builds/reverse_proxy
  ports:
    - "3000:443"
  links:
    - "server:protected.app"
  volumes_from:
    - shibconfig
rails:
  image: dukeauthenticationservice_server
  environment:
    - REDIS_HOST=redis.local
    - REDIS_PORT=6379
  volumes_from:
    - server
  links:
    - redis:redis.local
  entrypoint: ['rails']
rake:
  image: dukeauthenticationservice_server
  volumes_from:
    - server
  links:
    - redis:redis.local
  environment:
    - REDIS_HOST=redis.local
    - REDIS_PORT=6379
  entrypoint: ['rake']
consumer:
  image: dukeauthenticationservice_server
  environment:
    - UUID=c87de9f2-1690-4523-87dc-6395f665a757
    - REDIRECT_URI=https://192.168.99.100:3001
    - SECRET=baa098d5e9d5247a33a58e861ff75f7e22a7c5c96027f39efd12e144f34a31423d3aacf45ab79d2c7196907161ec957cd54352b085371b65a32a0e8acf8894e6
  volumes_from:
    - server
  entrypoint: ['rake']
  command: consumer:create
rspec:
  image: dukeauthenticationservice_server
  environment:
    - RAILS_ENV=test
    - REDIS_HOST=redis.local
    - REDIS_PORT=6379
  volumes_from:
    - server
  links:
    - redis:redis.local
  entrypoint: ['rspec']
  command: spec
